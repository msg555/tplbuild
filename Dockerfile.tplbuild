{{ begin_stage("tplbuild-base", from=("python", "3.10"), context="base", base=True) }}

WORKDIR /tplbuild

COPY . ./

# TODO: use setuptools instead of requirements files
{% if env == "dev" %}
  RUN pip install -r requirements.txt -r requirements-dev.txt
{% else %}
  RUN pip install -r requirements.txt -r requirements-dev.txt
{% endif %}


{{ begin_stage("tplbuild", from="tplbuild-base") }}

COPY . ./

ENV PYTHONPATH="${PYTHONPATH}:/tplbuild"
ENTRYPOINT ["python3", "-m", "tplbuild"]
